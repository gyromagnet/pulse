<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Pulse Program Parser</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg">

  <link rel="preload" href="styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript>
    <link rel="stylesheet" href="styles.css">
  </noscript>

  <script>
    window.handleLoadError = function (message) {
      const errorDiv = document.createElement("div");
      errorDiv.style.position = "fixed";
      errorDiv.style.top = "0";
      errorDiv.style.left = "0";
      errorDiv.style.right = "0";
      errorDiv.style.padding = "1em";
      errorDiv.style.background = "red";
      errorDiv.style.color = "white";
      errorDiv.style.zIndex = "10000";
      errorDiv.textContent = message;
      document.body.appendChild(errorDiv);
    };
  </script>

  <script src="https://cdn.jsdelivr.net/pyodide/v0.27.5/full/pyodide.js"
    onerror="handleLoadError('Failed to load. Please check your network connection.')"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.css"
    integrity="sha512-uf06llspW44/LZpHzHT6qBOIVODjWtv4MxCricRxkzvopAlSWnTf6hpZTFxuuZcuNE9CBQhqE0Seu1CoRk84nQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />



</head>

<body>
  <div class="icon-group">
    <div id="helpToggle" title="Help">
      <img src="icons/help.svg" alt="Help" width="20" height="20" />
    </div>
    <div id="settingsToggle" title="Settings">
      <img src="icons/settings.svg" alt="Settings" width="20" height="20" />
    </div>
  </div>

  <div id="pyodideStatus" class="loading-message">Loading Pyodide...</div>

  <h1>Pulse Program Parser</h1>

  <div class="split-pane">
    <div class="editor-container" id="left-pane">
      <div class="editor-block" id="grammar-block">
        <div class="editor-header">
          <h3>Grammar</h3>
          <div class="example-links">
            <a href="#" onclick="loadGrammarFile('grammars/bruker.lark')">Reload Grammar</a>
          </div>
        </div>
        <textarea id="grammar"></textarea>
      </div>

      <div class="resizer-horizontal" id="vertical-divider">
        <div class="grip-icon-horizontal"></div>
      </div>

      <div class="editor-block" id="input-block">
        <div class="editor-header">
          <h3>Pulse Code</h3>
          <div class="example-links">
            <a href="#" onclick="loadExampleFile('example_code/zg')">zg</a>
            <a href="#" onclick="loadExampleFile('example_code/hnco_3c_pfg_lek_600_sh_cp')">HNCO</a>
          </div>
        </div>
        <textarea id="input"></textarea>
      </div>
      <div class="editor-footer"></div>
    </div>

    <div class="resizer-vertical" id="column-divider">
      <div class="grip-icon-vertical"></div>
    </div>

    <div id="parseStatus" class="status-bar"></div>
    <div class="output-container">
      <div class="output-header">
        <h3>Parse Tree Output:</h3>
        <div>
          <button onclick="App.runParser()">Parse</button>
        </div>
      </div>
      <pre id="output"></pre>
      <div class="output-footer">
        <div>
          <button onclick="collapseAll()">Collapse All</button>
          <button onclick="expandAll()">Expand All</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.js"
    integrity="sha512-8RnEqURPUc5aqFEN04aQEiPlSAdE0jlFS/9iGgUyNtwFnSKCXhmB6ZTNl7LnDtDWKabJIASzXrzD0K+LYexU9g=="
    crossorigin="anonymous" referrerpolicy="no-referrer"
    onerror="handleLoadError('Failed to load. Please check your network connection.')"></script>

  <script src="ide.js"></script>
  <div id="toast" class="toast hidden"></div>

  <div class="popover" id="settingsPopover">
    <h3>Settings</h3>

    <h4>Display</h4>
    <div class="setting-item">
      <label for="compressCheckbox">Compact Tree View</label>
      <input type="checkbox" id="compressCheckbox" />
      <span class="tooltip" data-tooltip="Collapse single-rule chains in the parse tree for a cleaner view."><img
          src="icons/help.svg" alt="Help" width="20" height="20" /></span>
    </div>



    <div class="setting-item">
      <label for="showHiddenCheckbox">Include Hidden Tokens</label>
      <input type="checkbox" id="showHiddenCheckbox" />
      <span class="tooltip" data-tooltip="Show tokens like whitespace and punctuation that are usually hidden."><img
          src="icons/help.svg" alt="Help" width="20" height="20" /></span>
    </div>

    <h4 id="advancedToggle" class="collapsible-heading">Advanced Settings</h4>
    <div id="advancedSettings" class="collapsible-section hidden">
      <h4>Parser Options</h4>

      <div class="setting-item">
        <label for="parserSelect">Parser Algorithm</label>
        <select id="parserSelect">
          <option value="lalr">LALR</option>
          <option value="earley" selected>Earley</option>
        </select>
        <span class="tooltip"
          data-tooltip="Choose between LALR (fast) and Earley (more flexible, handles ambiguous grammars)."><img
            src="icons/help.svg" alt="Help" width="20" height="20" /></span>
      </div>

      <div class="setting-item">
        <select id="lexerSelect">
          <option value="basic">Basic</option>
          <option value="contextual">Contextual</option>
          <option value="dynamic" selected>Dynamic</option>
          <option value="dynamic_complete">Dynamic Complete</option>
        </select>
        <label for="lexerSelect">Lexing Mode</label>
        <span class="tooltip" data-tooltip="Choose how tokens are matched: basic, contextual, or dynamic."><img
            src="icons/help.svg" alt="Help" width="20" height="20" /></span>
      </div>

      <div class="setting-item">
        <label for="regexSelect">Regex Engine</label>
        <select id="regexSelect">
          <option value="re">re (built-in)</option>
          <option value="regex" selected>regex (enhanced)</option>
        </select>
        <span class="tooltip" data-tooltip="Use Python's built-in 're' or the more powerful 'regex' engine."><img
            src="icons/help.svg" alt="Help" width="20" height="20" /></span>
      </div>

      <div class="setting-item">
        <label for="debugCheckbox">Enable Debug Mode</label>
        <input type="checkbox" id="debugCheckbox" />
        <span class="tooltip" data-tooltip="Print detailed logs from the parser. For development only."><img
            src="icons/help.svg" alt="Help" width="20" height="20" /></span>
      </div>

      <div class="setting-item">
        <label for="strictCheckbox">Strict Grammar Mode</label>
        <input type="checkbox" id="strictCheckbox" />
        <span class="tooltip" data-tooltip="Enforce strict grammar validation and reject undefined rules."><img
            src="icons/help.svg" alt="Help" width="20" height="20" /></span>
      </div>

      <div class="setting-item">
        <label for="startInput">Starting Rule</label>
        <input type="text" id="startInput" value="pulseprogram" />
        <span class="tooltip"
          data-tooltip="The name of the rule to start parsing from. Default is usually 'start'."><img
            src="icons/help.svg" alt="Help" width="20" height="20" /></span>
      </div>
    </div>

    <div class="settings-footer">
      <button id="resetWorkspaceBtn" onclick="resetWorkspace()">Reset Workspace</button>
    </div>
  </div>

  <div class="popover" id="helpPopover">
    <h3>Help & Instructions</h3>
    <p>This tool allows you to edit a grammar and corresponding input, then visualize the parse tree in real time.</p>

    <h4><img src="icons/edit.svg" alt="Settings" width="20" height="20" /> Editing</h4>
    <ul>
      <li><strong>Grammar</strong>: Write or paste your Lark grammar here.</li>
      <li><strong>Pulse Code</strong>: Your input source to parse using the grammar.</li>
      <li>Drag and drop text files into either editor to quickly load them.</li>
    </ul>

    <h4><img src="icons/parsing.svg" alt="Settings" width="20" height="20" /> Parsing</h4>
    <ul>
      <li><strong>Run parser</strong>: Press <kbd>Ctrl</kbd>/<kbd>Cmd</kbd> + <kbd>Enter</kbd> or click "Parse".</li>
      <li>Parsing options (parser type, lexer mode, etc.) are in the <em>Settings</em> panel.</li>
      <li>Error messages are shown inline if parsing fails.</li>
    </ul>

    <h4><img src="icons/tree.svg" alt="Settings" width="20" height="20" /> Parse Tree Interaction</h4>
    <ul>
      <li>Tree nodes are interactive â€” click to expand/collapse rules.</li>
      <li>Double-click on:
        <ul>
          <li><strong>Input</strong>: Jumps to and highlights corresponding node in the tree.</li>
          <li><strong>Tree</strong>: Jumps to and highlights corresponding text in input.</li>
        </ul>
      </li>
      <li><strong>Hover</strong>: Highlights matching tokens or rules in both views.</li>
      <li><strong>Selecting text</strong> in the input highlights all matching tree nodes.</li>
      <li><strong>Collapse All</strong> / <strong>Expand All</strong>: Use bottons below parse tree to quickly
        fold/unfold the entire tree.</li>
    </ul>

    <h4><img src="icons/settings.svg" alt="Settings" width="20" height="20" /> Settings</h4>
    <ul>
      <li>Accessible form the gear icon in the top right corner.</li>
      <li>Tree Display Controls</li>
      <ul>
        <li><strong>Compress Tree Paths</strong>: Groups single-child rule chains into a compact view.</li>
        <li><strong>Show Hidden Tokens</strong>: Display or hide tokens prefixed with underscores (_).</li>
      </ul>
    </ul>
  </div>



</body>

</html>
